{
	"name": "airports",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "airportsCSVLake",
						"type": "DatasetReference"
					},
					"name": "airports"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "airportCount",
						"type": "DatasetReference"
					},
					"name": "AirportCount"
				}
			],
			"transformations": [
				{
					"name": "usa"
				},
				{
					"name": "stateAirports"
				},
				{
					"name": "sortedAirports"
				}
			],
			"script": "source(output(\n\t\tIATA_CODE as string,\n\t\tAIRPORT as string,\n\t\tCITY as string,\n\t\tSTATE as string,\n\t\tCOUNTRY as string,\n\t\tLATITUDE as string,\n\t\tLONGITUDE as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: true) ~> airports\nairports filter(rlike(COUNTRY, 'USA')) ~> usa\nusa aggregate(groupBy(STATE),\n\tAIRPORT = count(AIRPORT)) ~> stateAirports\nstateAirports sort(desc(AIRPORT, false)) ~> sortedAirports\nsortedAirports sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tpartitionFileNames:['airportCount.csv'],\n\ttruncate: true,\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> AirportCount"
		}
	}
}